<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>Geo Validator Lab</title>
  <meta name="description" content="A minimal landing page for launching the static visualization with custom settings."/>
  <style>
    :root {
      --bg1: #0f1226;
      --bg2: #171a36;
      --bg3: #0b0f22;
      --fg:  #e8eaf6;
      --muted:#aab0d6;
      --brand:#7aa2ff;
      --brand-2:#6ae3ff;
      --glass-bg: rgba(255,255,255,0.06);
      --glass-border: rgba(255,255,255,0.16);
      --shadow: 0 10px 30px rgba(0,0,0,0.35);
      --radius: 18px;
    }
    html, body {
      height: 100%;
      margin: 0;
      color: var(--fg);
      background: radial-gradient(1200px 800px at 20% 10%, #20265b 0%, transparent 60%),
                  radial-gradient(1000px 700px at 80% 20%, #103b5f 0%, transparent 60%),
                  radial-gradient(1200px 900px at 50% 100%, #1b3266 0%, transparent 60%),
                  linear-gradient(160deg, var(--bg1), var(--bg2) 40%, var(--bg3) 100%);
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, Arial, sans-serif;
    }
    .wrap {
      min-height: 100%;
      display: grid;
      grid-template-rows: 1fr auto;
    }
    .container {
      display: grid;
      place-items: center;
      padding: 24px;
    }
    .card {
      width: min(980px, 92vw);
      background: var(--glass-bg);
      border: 1px solid var(--glass-border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      padding: 28px;
      position: relative;
      overflow: hidden;
      min-height: 61.8vh;
    }
    .glow {
      position: absolute;
      inset: -60%;
      background: radial-gradient(600px 400px at 20% 20%, rgba(122,162,255,0.12), transparent 60%),
                  radial-gradient(600px 400px at 80% 30%, rgba(106,227,255,0.12), transparent 60%);
      filter: blur(10px);
      pointer-events: none;
      z-index: 0;
      animation: float 14s ease-in-out infinite alternate;
    }
    @keyframes float {
      0%   { transform: translate3d(0, 0, 0) scale(1); }
      100% { transform: translate3d(0, -12px, 0) scale(1.02); }
    }
    .content {
      position: relative;
      z-index: 1;
    }
    .brand {
      display: flex;
      align-items: center;
      gap: 12px;
      margin-bottom: 8px;
    }
    .brand .logo {
      width: 50px;
      height: 50px;
      border-radius: 12px;
      object-fit: contain;
      background: rgba(255,255,255,0.12);
      border: 1px solid rgba(255,255,255,0.18);
    }
    h1 {
      margin: 0;
      font-size: clamp(28px, 4vw, 40px);
      letter-spacing: 0.2px;
    }
    .lead {
      margin: 6px 0 22px 0;
      color: var(--muted);
      font-size: clamp(14px, 1.8vw, 16px);
      line-height: 1.6;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(12, 1fr);
      gap: 14px;
      margin-top: 10px;
      margin-bottom: 8px;
    }
    .item {
      grid-column: span 12;
      background: rgba(255,255,255,0.04);
      border: 1px solid rgba(255,255,255,0.12);
      border-radius: 14px;
      padding: 14px;
    }
    @media (min-width: 720px) {
      .item.sm-6 { grid-column: span 6; }
      .item.sm-4 { grid-column: span 4; }
      .item.sm-3 { grid-column: span 3; }
    }
    .label { display: block; font-weight: 600; margin-bottom: 6px; }
    select, input[type="number"], input[type="text"] {
      width: 100%; box-sizing: border-box;
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid rgba(255,255,255,0.22);
      background: rgba(0,0,0,0.25);
      color: var(--fg);
      outline: none;
    }
    select:focus, input:focus {
      border-color: var(--brand);
      box-shadow: 0 0 0 3px rgba(122,162,255,0.25);
    }
    .row { display: flex; align-items: center; gap: 12px; flex-wrap: wrap; }
    .hint { color: var(--muted); font-size: 12px; margin-top: 6px; }
    .cta {
      display: flex; justify-content: space-between; align-items: center;
      gap: 12px; margin-top: 14px; flex-wrap: wrap;
    }
    .btn {
      border: 0; border-radius: 12px; padding: 12px 18px;
      font-weight: 700; letter-spacing: 0.3px;
      color: #0b1220;
      background: linear-gradient(135deg, var(--brand), var(--brand-2));
      box-shadow: 0 8px 20px rgba(122,162,255,0.35);
      cursor: pointer;
      transition: transform .08s ease, filter .2s ease;
    }
    .dataset-row {
      display: grid;
      grid-template-columns: 1.2fr 1.2fr 1fr;
      gap: 12px;
    }
    .btn:hover { filter: brightness(1.05); }
    .btn:active { transform: translateY(1px); }
    .link { color: var(--muted); text-decoration: none; }
    .link:hover { color: var(--fg); }
    footer { color: var(--muted); text-align: center; padding: 18px; font-size: 12px; }
  </style>
</head>
<body>
<div class="wrap">
  <main class="container">
    <section class="card">
      <div class="glow" aria-hidden="true"></div>
      <div class="content">
        <!-- Brand with icon -->
        <div class="brand">
          <img class="logo" src="assets/logo.jpg" alt="Logo"/>
          <h1>Geographical Decentralization Simulation</h1>
        </div>
        <p class="lead">
This project provides a lightweight interface for the simulations of the geographical decentralization of Ethereum validators that we developed as part of our research.
Our motivation is to better understand the dynamics of validator placement, latency, and performance in decentralized networks. Running such simulations allows us to test different assumptions, compare strategies, and identify where centralization pressures may arise.  

To make these results accessible without requiring users to re-run large experiments, we have  preprocessed several simulation datasets and included them here as interactive demos. By selecting  among these results and adjusting a few viewer options, you can quickly visualize the spatial  distribution of validators, observe the impact of parameters such as density and distance, and  gain an intuition for how validator ecosystems evolve under different conditions.  
        </p>

        <div class="grid">
          <div class="item sm-6">
            <label class="label" for="dataset">Dataset</label>
            <div class="dataset-row">
              <select id="ds-folder">
                <option value="" disabled selected>Dataset</option>
              </select>

              <select id="ds-sub" disabled>
                <option value="" disabled selected>Select a paradigm</option>
              </select>

              <select id="ds-name" disabled>
                <option value="" disabled selected>Cost</option>
              </select>
            </div>

            <!-- This will hold the final relative path you need -->
            <input id="dataset" type="hidden" value="" />
            <div class="hint">Relative path to your preprocessed data file.</div>
          </div>
          <div class="item sm-3">
            <label class="label" for="theme">Theme</label>
            <select id="theme">
              <option value="auto">Auto</option>
              <option value="light">Light</option>
              <option value="dark">Dark</option>
            </select>
          </div>
          <div class="item sm-3">
            <label class="label" for="step">Step size</label>
            <select id="step">
              <option value="1">1</option>
              <option value="10">10</option>
              <option value="50">50</option>
            </select>
          </div>
          <div class="item sm-6">
            <div class="label">Autoplay</div>
            <div class="row">
              <label><input type="radio" name="autoplay" value="on" checked> On</label>
              <label><input type="radio" name="autoplay" value="off"> Off</label>
            </div>
          </div>
          <div class="item sm-3">
            <label class="label" for="decim">Border decimation</label>
            <select id="decim">
              <option value="5" selected>5</option>
              <option value="1">1</option>
              <option value="8">8</option>
              <option value="12">12</option>
            </select>
          </div>
          <div class="item sm-3">
            <label class="label" for="radius">Density radius</label>
            <input id="radius" type="number" step="0.01" min="0.01" max="3" value="0.20"/>
          </div>
        </div>

        <div class="cta">
          <a class="link" href="#" onclick="prefillDemo()">Fill demo values</a>
          <button class="btn" id="launch">Launch Viewer</button>
        </div>
      </div>
    </section>
  </main>
  <footer>
    Static viewer launcher
  </footer>
</div>

<script>
    const DATASETS = {
      test: {
        SSP: ["data"]
      },
      baseline: {
        MSP: ["cost_0.0", "cost_0.001", "cost_0.002", "cost_0.003"],
        SSP: ["cost_0.0", "cost_0.001", "cost_0.002", "cost_0.003"]
      },
      heterogeneous_info: {
        MSP: ["cost_0.002_latency_latency-aligned", "cost_0.002_latency_latency-misaligned"],
        SSP: ["cost_0.002_latency_latency-aligned", "cost_0.002_latency_latency-misaligned"]
      },
      heterogeneous_validator: {
        MSP: ["cost_0.0_validators_heterogeneous", "cost_0.002_validators_heterogeneous"],
        SSP: ["cost_0.0_validators_heterogeneous", "cost_0.002_validators_heterogeneous"]
      },
      heterogeneous_both: {
        MSP: ["cost_0.002_latency_latency-aligned", "cost_0.002_latency_latency-misaligned"],
        SSP: ["cost_0.002_latency_latency-aligned", "cost_0.002_latency_latency-misaligned"]
      },
      different_gammas: {
        MSP: ["cost_0.002_gamma_0.3333", "cost_0.002_gamma_0.5", "cost_0.002_gamma_0.6667", "cost_0.002_gamma_0.8"],
        SSP: ["cost_0.002_gamma_0.3333", "cost_0.002_gamma_0.5", "cost_0.002_gamma_0.6667", "cost_0.002_gamma_0.8"]
      },
      eip7702: {
        MSP: ["cost_0.002_delta_6000_cutoff_3000"],
        SSP: ["cost_0.002_delta_6000_cutoff_3000"]
      }
    };

  const folderSel = document.getElementById("ds-folder");
  const subSel = document.getElementById("ds-sub");
  const nameSel = document.getElementById("ds-name");
  const hiddenPath = document.getElementById("dataset");

  function setOptions(selectEl, items, placeholderText) {
    selectEl.innerHTML = "";
    const ph = document.createElement("option");
    ph.value = "";
    ph.disabled = true;
    ph.selected = true;
    ph.textContent = placeholderText;
    selectEl.appendChild(ph);

    for (const it of items) {
      const opt = document.createElement("option");
      opt.value = it;
      opt.textContent = it;
      selectEl.appendChild(opt);
    }
  }

  // init folder options
  setOptions(folderSel, Object.keys(DATASETS), "Select an evaluation");
  subSel.disabled = true;
  nameSel.disabled = true;

  folderSel.addEventListener("change", () => {
    const folder = folderSel.value;
    const subs = Object.keys(DATASETS[folder] || {});
    setOptions(subSel, subs, "Select a paradigm");
    subSel.disabled = subs.length === 0;
    nameSel.disabled = true;
    hiddenPath.value = "";
  });

  subSel.addEventListener("change", () => {
    const folder = folderSel.value;
    const sub = subSel.value;
    const names = (DATASETS[folder] && DATASETS[folder][sub]) ? DATASETS[folder][sub] : [];
    setOptions(nameSel, names, "Select a simulation result");
    nameSel.disabled = names.length === 0;
    hiddenPath.value = "";
  });

  nameSel.addEventListener("change", () => {
    const folder = folderSel.value;
    const sub = subSel.value;
    const name = nameSel.value;

    hiddenPath.value = `simulations/${folder}/${sub}/${name}/data.json`;
  });

  const TARGET_PAGE = 'viewer.html';
  function prefillDemo() {
    document.getElementById('dataset').value = 'simulations/test/SSP/data/data.json';
    document.getElementById('theme').value = 'dark';
    document.getElementById('step').value = '10';
    document.querySelector('input[name="autoplay"][value="on"]').checked = true;
    document.getElementById('decim').value = '5';
    document.getElementById('radius').value = '0.20';
  }
  function saveSettings() {
    const settings = {
      dataset: document.getElementById('dataset').value,
      theme:   document.getElementById('theme').value,
      step:    parseInt(document.getElementById('step').value || '1', 10),
      autoplay: document.querySelector('input[name="autoplay"]:checked').value === 'on',
      decimation: parseInt(document.getElementById('decim').value || '5', 10),
      density_radius: parseFloat(document.getElementById('radius').value || '0.20')
    };
    try { localStorage.setItem('app_settings', JSON.stringify(settings)); } catch (_) {}
    const params = new URLSearchParams(settings);
    window.location.href = `${TARGET_PAGE}?${params.toString()}`;
  }
  document.getElementById('launch').addEventListener('click', saveSettings);
</script>
</body>
</html>
